<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âtape 3 - Informations parents - √âcole La Victoire</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/bilingual.css">
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo-icon">üéì</div>
                <div class="logo-text">
                    <div class="logo-title">√âcole La Victoire</div>
                    <div class="logo-subtitle">ŸÖÿØÿ±ÿ≥ÿ© ÿßŸÑŸÜÿµÿ±</div>
                </div>
            </div>
            <div class="operator-info">
                <div class="language-switch">
                    <button onclick="setLanguage('fr')" class="lang-btn active" id="langFr">FR</button>
                    <button onclick="setLanguage('ar')" class="lang-btn" id="langAr">ÿπÿ±</button>
                </div>
                <span id="operatorName">Op√©ratrice: </span>
                <div class="operator-avatar">O</div>
            </div>
        </div>
    </header>

    <div class="progress-wrapper">
        <div class="progress-bar">
            <div class="progress-line">
                <div class="progress-line-active" style="width: 42.8%;"></div>
            </div>
            <div class="progress-step">
                <div class="step-circle completed">‚úì</div>
                <div class="step-label">Type</div>
            </div>
            <div class="progress-step">
                <div class="step-circle completed">‚úì</div>
                <div class="step-label">√âl√®ve</div>
            </div>
            <div class="progress-step">
                <div class="step-circle active">3</div>
                <div class="step-label">Parents</div>
            </div>
            <div class="progress-step">
                <div class="step-circle">4</div>
                <div class="step-label">Services</div>
            </div>
            <div class="progress-step">
                <div class="step-circle">5</div>
                <div class="step-label">M√©dical</div>
            </div>
            <div class="progress-step">
                <div class="step-circle">6</div>
                <div class="step-label">Fournitures</div>
            </div>
            <div class="progress-step">
                <div class="step-circle">7</div>
                <div class="step-label">Validation</div>
            </div>
        </div>
    </div>

    <main class="main-content">
        <div class="welcome-section">
            <h1 class="welcome-title bilingual">
                <span class="fr">Informations des parents</span>
                <span class="ar">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸàÿßŸÑÿØŸäŸÜ</span>
            </h1>
            <p class="welcome-subtitle bilingual">
                <span class="fr">Coordonn√©es des parents/tuteurs - Ann√©e scolaire 2025-2026</span>
                <span class="ar">ŸÖÿπŸÑŸàŸÖÿßÿ™ ÿßŸÑŸàÿßŸÑÿØŸäŸÜ/ÿßŸÑÿ£ŸàÿµŸäÿßÿ° - ÿßŸÑÿ≥ŸÜÿ© ÿßŸÑÿØÿ±ÿßÿ≥Ÿäÿ© 2025-2026</span>
            </p>
        </div>

        <form id="step3Form" class="fade-in">
            <div class="form-container">
                <!-- P√®re -->
                <div class="form-section">
                    <h3 class="section-title">üë® Informations du p√®re</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="fatherFirstname" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nom de famille *</label>
                            <input type="text" class="form-control" id="fatherLastname" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Profession *</label>
                            <input type="text" class="form-control" id="fatherProfession" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone *</label>
                            <input type="tel" class="form-control" id="fatherPhone" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="fatherEmail">
                    </div>
                </div>

                <!-- M√®re -->
                <div class="form-section">
                    <h3 class="section-title">üë© Informations de la m√®re</h3>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pr√©nom *</label>
                            <input type="text" class="form-control" id="motherFirstname" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Nom de famille *</label>
                            <input type="text" class="form-control" id="motherLastname" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Profession *</label>
                            <input type="text" class="form-control" id="motherProfession" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone *</label>
                            <input type="tel" class="form-control" id="motherPhone" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="motherEmail">
                    </div>
                </div>

                <!-- Contact d'urgence -->
                <div class="form-section">
                    <h3 class="section-title bilingual">
                        <span class="fr">üö® Contact d'urgence</span>
                        <span class="ar">üö® ÿ¨Ÿáÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶</span>
                    </h3>
                    
                    <div class="form-group">
                        <label class="form-label bilingual">
                            <span class="fr">Contact d'urgence *</span>
                            <span class="ar">ÿ¨Ÿáÿ© ÿßŸÑÿßÿ™ÿµÿßŸÑ ŸÅŸä ÿ≠ÿßŸÑÿ© ÿßŸÑÿ∑Ÿàÿßÿ±ÿ¶ *</span>
                        </label>
                        <div class="radio-group">
                            <label class="radio-option">
                                <input type="radio" name="urgencyContact" value="pere" onchange="updateUrgencyContact()">
                                <span class="radio-custom"></span>
                                <span class="bilingual">
                                    <span class="fr">P√®re</span>
                                    <span class="ar">ÿßŸÑÿ£ÿ®</span>
                                </span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="urgencyContact" value="mere" onchange="updateUrgencyContact()">
                                <span class="radio-custom"></span>
                                <span class="bilingual">
                                    <span class="fr">M√®re</span>
                                    <span class="ar">ÿßŸÑÿ£ŸÖ</span>
                                </span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="urgencyContact" value="autre" onchange="updateUrgencyContact()">
                                <span class="radio-custom"></span>
                                <span class="bilingual">
                                    <span class="fr">Autre personne</span>
                                    <span class="ar">ÿ¥ÿÆÿµ ÿ¢ÿÆÿ±</span>
                                </span>
                            </label>
                        </div>
                    </div>

                    <div id="urgencyOtherDetails" style="display: none;">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label bilingual">
                                    <span class="fr">Relation *</span>
                                    <span class="ar">ÿµŸÑÿ© ÿßŸÑŸÇÿ±ÿßÿ®ÿ© *</span>
                                </label>
                                <select class="form-control" id="urgencyRelation">
                                    <option value="" data-fr="S√©lectionnez" data-ar="ÿßÿÆÿ™ÿ±">S√©lectionnez</option>
                                    <option value="Grand-p√®re" data-fr="Grand-p√®re" data-ar="ÿßŸÑÿ¨ÿØ">Grand-p√®re</option>
                                    <option value="Grand-m√®re" data-fr="Grand-m√®re" data-ar="ÿßŸÑÿ¨ÿØÿ©">Grand-m√®re</option>
                                    <option value="Oncle" data-fr="Oncle" data-ar="ÿßŸÑÿπŸÖ/ÿßŸÑÿÆÿßŸÑ">Oncle</option>
                                    <option value="Tante" data-fr="Tante" data-ar="ÿßŸÑÿπŸÖÿ©/ÿßŸÑÿÆÿßŸÑÿ©">Tante</option>
                                    <option value="Fr√®re/S≈ìur" data-fr="Fr√®re/S≈ìur" data-ar="ÿßŸÑÿ£ÿÆ/ÿßŸÑÿ£ÿÆÿ™">Fr√®re/S≈ìur</option>
                                    <option value="Ami de famille" data-fr="Ami de famille" data-ar="ÿµÿØŸäŸÇ ÿßŸÑÿπÿßÿ¶ŸÑÿ©">Ami de famille</option>
                                    <option value="Voisin" data-fr="Voisin" data-ar="ÿßŸÑÿ¨ÿßÿ±">Voisin</option>
                                    <option value="Autre" data-fr="Autre" data-ar="ÿ¢ÿÆÿ±">Autre</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nom complet *</label>
                                <input type="text" class="form-control" id="urgencyName" placeholder="Nom et pr√©nom">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">T√©l√©phone *</label>
                            <input type="tel" class="form-control" id="urgencyPhone" placeholder="0X XX XX XX XX">
                        </div>
                    </div>

                    <!-- Informations pr√©-remplies -->
                    <div id="urgencyInfo" class="emergency-info" style="display: none;">
                        <div class="info-card">
                            <h4 id="urgencyTitle">Contact d'urgence :</h4>
                            <p id="urgencyDetails"></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="navigation-buttons">
                <button type="button" class="btn btn-secondary" onclick="goBack()">
                    <span class="fr">Pr√©c√©dent</span>
                    <span class="ar">ÿßŸÑÿ≥ÿßÿ®ŸÇ</span>
                </button>
                <button type="submit" class="btn btn-primary" id="nextBtn">
                    <span class="fr">Suivant</span>
                    <span class="ar">ÿßŸÑÿ™ÿßŸÑŸä</span>
                </button>
            </div>
        </form>
    </main>

    <script src="../js/bilingual.js"></script>
    <script>
        window.onload = function() {
            const operatorName = localStorage.getItem('operatorName');
            if (!operatorName) {
                window.location.href = '../index.html';
                return;
            }
            document.getElementById('operatorName').textContent = 'Op√©ratrice: ' + operatorName;
            
            // Charger la langue sauvegard√©e
            const savedLanguage = localStorage.getItem('selectedLanguage') || 'fr';
            setLanguage(savedLanguage);
            
            setupValidation();
            loadSavedData();
            // Valider le formulaire apr√®s le chargement des donn√©es
            setTimeout(validateForm, 100);
        };

        function setupValidation() {
            const requiredFields = [
                'fatherFirstname', 'fatherLastname', 'fatherProfession', 'fatherPhone',
                'motherFirstname', 'motherLastname', 'motherProfession', 'motherPhone'
            ];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    field.addEventListener('input', validateForm);
                    field.addEventListener('change', validateForm);
                }
            });
        }

        function updateUrgencyContact() {
            const selectedContact = document.querySelector('input[name="urgencyContact"]:checked');
            const urgencyOtherDetails = document.getElementById('urgencyOtherDetails');
            const urgencyInfo = document.getElementById('urgencyInfo');
            const urgencyTitle = document.getElementById('urgencyTitle');
            const urgencyDetails = document.getElementById('urgencyDetails');
            
            if (!selectedContact) return;
            
            if (selectedContact.value === 'pere') {
                const fatherName = document.getElementById('fatherFirstname').value + ' ' + document.getElementById('fatherLastname').value;
                const fatherPhone = document.getElementById('fatherPhone').value;
                
                urgencyOtherDetails.style.display = 'none';
                urgencyInfo.style.display = 'block';
                urgencyTitle.textContent = 'Contact d\'urgence : P√®re';
                urgencyDetails.innerHTML = `<strong>${fatherName}</strong><br>T√©l√©phone: ${fatherPhone}`;
                
            } else if (selectedContact.value === 'mere') {
                const motherName = document.getElementById('motherFirstname').value + ' ' + document.getElementById('motherLastname').value;
                const motherPhone = document.getElementById('motherPhone').value;
                
                urgencyOtherDetails.style.display = 'none';
                urgencyInfo.style.display = 'block';
                urgencyTitle.textContent = 'Contact d\'urgence : M√®re';
                urgencyDetails.innerHTML = `<strong>${motherName}</strong><br>T√©l√©phone: ${motherPhone}`;
                
            } else if (selectedContact.value === 'autre') {
                urgencyOtherDetails.style.display = 'block';
                urgencyInfo.style.display = 'none';
                
                // Ajouter les √©v√©nements pour les nouveaux champs
                ['urgencyRelation', 'urgencyName', 'urgencyPhone'].forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (field) {
                        field.addEventListener('input', validateForm);
                        field.addEventListener('change', validateForm);
                    }
                });
            }
            
            validateForm();
        }

        function validateForm() {
            const requiredFields = [
                'fatherFirstname', 'fatherLastname', 'fatherProfession', 'fatherPhone',
                'motherFirstname', 'motherLastname', 'motherProfession', 'motherPhone'
            ];
            
            let isValid = true;
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    isValid = false;
                }
            });

            // V√©rifier le contact d'urgence
            const selectedContact = document.querySelector('input[name="urgencyContact"]:checked');
            if (!selectedContact) {
                isValid = false;
            } else if (selectedContact.value === 'autre') {
                // V√©rifier les champs "autre"
                const urgencyFields = ['urgencyRelation', 'urgencyName', 'urgencyPhone'];
                urgencyFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field || !field.value.trim()) {
                        isValid = false;
                    }
                });
            }
            
            const nextBtn = document.getElementById('nextBtn');
            if (nextBtn) {
                nextBtn.disabled = !isValid;
                nextBtn.style.opacity = isValid ? '1' : '0.6';
            }
        }

        function loadSavedData() {
            const saved = localStorage.getItem('inscriptionData');
            if (saved) {
                const data = JSON.parse(saved);
                
                // Charger les champs parents
                const parentFields = [
                    'fatherFirstname', 'fatherLastname', 'fatherProfession', 'fatherPhone', 'fatherEmail',
                    'motherFirstname', 'motherLastname', 'motherProfession', 'motherPhone', 'motherEmail'
                ];
                
                parentFields.forEach(field => {
                    if (data[field] && document.getElementById(field)) {
                        document.getElementById(field).value = data[field];
                    }
                });
                
                // Charger les champs d'urgence avec les bons IDs
                const urgencyFields = [
                    {key: 'urgencyRelation', id: 'urgencyRelation'},
                    {key: 'urgencyName', id: 'urgencyName'},
                    {key: 'urgencyPhone', id: 'urgencyPhone'}
                ];
                
                urgencyFields.forEach(field => {
                    if (data[field.key] && document.getElementById(field.id)) {
                        document.getElementById(field.id).value = data[field.key];
                    }
                });
                
                // Restaurer le contact d'urgence s√©lectionn√©
                if (data.urgencyContactType) {
                    const radioButton = document.querySelector(`input[name="urgencyContact"][value="${data.urgencyContactType}"]`);
                    if (radioButton) {
                        radioButton.checked = true;
                        // D√©clencher le changement pour afficher les champs appropri√©s
                        radioButton.dispatchEvent(new Event('change'));
                    }
                }
            }
        }

        function saveData() {
            const saved = localStorage.getItem('inscriptionData');
            const existingData = saved ? JSON.parse(saved) : {};
            
            const newData = {};
            
            // Sauvegarder les champs parents avec v√©rification d'existence
            const parentFields = [
                'fatherFirstname', 'fatherLastname', 'fatherProfession', 'fatherPhone', 'fatherEmail',
                'motherFirstname', 'motherLastname', 'motherProfession', 'motherPhone', 'motherEmail'
            ];
            
            parentFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) {
                    newData[fieldId] = field.value;
                }
            });
            
            // Sauvegarder les champs d'urgence avec les bons IDs
            const urgencyFields = [
                {id: 'urgencyRelation', key: 'urgencyRelation'},
                {id: 'urgencyName', key: 'urgencyName'},
                {id: 'urgencyPhone', key: 'urgencyPhone'}
            ];
            
            urgencyFields.forEach(field => {
                const element = document.getElementById(field.id);
                if (element) {
                    newData[field.key] = element.value;
                }
            });
            
            // Sauvegarder le contact d'urgence s√©lectionn√©
            const selectedContact = document.querySelector('input[name="urgencyContact"]:checked');
            if (selectedContact) {
                newData.urgencyContactType = selectedContact.value;
            }
            
            Object.assign(existingData, newData);
            localStorage.setItem('inscriptionData', JSON.stringify(existingData));
        }

        function goBack() {
            window.location.href = 'step2-informations-eleve.html';
        }

        document.getElementById('step3Form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // V√©rifier si tous les champs requis sont remplis
            const requiredFields = [
                'fatherFirstname', 'fatherLastname', 'fatherProfession', 'fatherPhone',
                'motherFirstname', 'motherLastname', 'motherProfession', 'motherPhone'
            ];
            
            let isValid = true;
            let missingFields = [];
            
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (!field || !field.value.trim()) {
                    isValid = false;
                    if (field) {
                        field.style.borderColor = '#ef4444';
                        const label = document.querySelector(`label[for="${fieldId}"]`) || 
                                    field.previousElementSibling;
                        if (label) missingFields.push(label.textContent.replace(' *', ''));
                    }
                } else {
                    if (field) field.style.borderColor = '#d1d5db';
                }
            });

            // V√©rifier le contact d'urgence
            const selectedContact = document.querySelector('input[name="urgencyContact"]:checked');
            if (!selectedContact) {
                isValid = false;
                missingFields.push('Contact d\'urgence');
            } else if (selectedContact.value === 'autre') {
                const urgencyFields = ['urgencyRelation', 'urgencyName', 'urgencyPhone'];
                urgencyFields.forEach(fieldId => {
                    const field = document.getElementById(fieldId);
                    if (!field || !field.value.trim()) {
                        isValid = false;
                        if (field) field.style.borderColor = '#ef4444';
                    } else {
                        if (field) field.style.borderColor = '#d1d5db';
                    }
                });
            }
            
            if (isValid) {
                saveData();
                window.location.href = 'step4-services.html';
            } else {
                alert('Veuillez remplir tous les champs obligatoires : ' + missingFields.join(', '));
            }
        });

        document.getElementById('step3Form').addEventListener('change', saveData);
        document.getElementById('step3Form').addEventListener('input', saveData);
    </script>

    <style>
        .form-section {
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        .section-title {
            color: var(--primary-color);
            margin-bottom: 1.5rem;
            font-size: 1.2rem;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 0.5rem;
        }

        .radio-group {
            display: flex;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.5rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .radio-option:hover {
            border-color: var(--primary-color);
            background: #f8fafc;
        }

        .radio-option input[type="radio"] {
            display: none;
        }

        .radio-custom {
            width: 20px;
            height: 20px;
            border: 2px solid #d1d5db;
            border-radius: 50%;
            position: relative;
            transition: all 0.2s ease;
        }

        .radio-option input[type="radio"]:checked + .radio-custom {
            border-color: var(--primary-color);
            background: var(--primary-color);
        }

        .radio-option input[type="radio"]:checked + .radio-custom::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 8px;
            height: 8px;
            background: white;
            border-radius: 50%;
        }

        .emergency-info {
            margin-top: 1rem;
        }

        .info-card {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 8px;
            padding: 1rem;
        }

        .info-card h4 {
            color: var(--primary-color);
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
        }

        .info-card p {
            margin: 0;
            color: #374151;
        }

        @media (max-width: 768px) {
            .radio-group {
                flex-direction: column;
                gap: 0.5rem;
            }
        }
    </style>
</body>
</html>